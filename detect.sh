#!/bin/bash

. /root/work/malware/checker.sh

rm -r /root/work/malware/hashes/new; mkdir /root/work/malware/hashes/new

checkPath >> /root/work/malware/hashes/new/path.txt

dif=`diff /root/work/malware/hashes/new/path.txt /root/work/malware/hashes/path.txt`
if [[ -z $dif ]]
  then
    echo "No Difference in Path"
  else
    echo "Change Detected In Path"
    logger -p local0.notice "xCHANGEx Change Detected In Path Variable"
fi
if [[ $# -ne 1 ]]
  then
    echo "No Critical File List Provided"
  else
    shopt -s -o nounset
    line=0
    while read filePath
      do
        let ++line
        if [[ -z $filePath ]]
          then
            continue
        fi

        if [[ ${filePath:0:1} = "#" ]]
          then
            continue
        fi

        checkFile $filePath >> /root/work/malware/hashes/new/critical.txt
    done < $1

dif=`diff /root/work/malware/hashes/new/critical.txt /root/work/malware/hashes/critical.txt`

if [[ -z $dif ]]
  then
    echo "No Difference in Critical Files"
  else
    echo "Change in Critical Files"
    logger -p local0.notice "xCHANGEx Change Detected In Critical Files"
fi
fi

checkSharedObjects >> /root/work/malware/hashes/new/sharedobjects.txt

dif=`diff /root/work/malware/hashes/new/sharedobjects.txt /root/work/malware/hashes/sharedobjects.txt`

if [[ -z $dif ]]
  then
    echo "No Difference in Shared Objects"
  else
    echo "Change in Shared Objects"
    logger -p local0.notice "xCHANGEx Change Detected In Shared Objects"
fi
checkSUIDFiles >> /root/work/malware/hashes/new/suidfiles.txt

dif=`diff /root/work/malware/hashes/new/suidfiles.txt /root/work/malware/hashes/suidfiles.txt`

if [[ -z $dif ]]
  then
    echo "No Difference in SUID Files"
  else
    echo "Change in SUID Files"
    logger -p local0.notice "xCHANGEx Change Detected In SUID Files"
fi
echo "All Done"


